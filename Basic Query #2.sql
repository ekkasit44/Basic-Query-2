?--Student ID
--Student Name

-- *********????????? Basic Query #2 ***************
 
 --1. ???????????????? ?????????? ???????????? ????????????????? Seafood
 --??? Product
 
--??? Join
SELECT  p.ProductID, p.ProductName, p.UnitPrice
FROM    Products p
JOIN    Categories c ON p.CategoryID = c.CategoryID
WHERE   c.CategoryName = 'Seafood';
---------------------------------------------------------------------
--2.?????????????????????? ??????????????????? ??????????????????????????????? ? ????????????????????? 1997
--??? Product


--??? Join

SELECT  c.CompanyName, c.Country,
        COUNT(o.OrderID) AS OrderCount
FROM    Customers c
JOIN    Orders o ON c.CustomerID = o.CustomerID
WHERE   YEAR(o.OrderDate) = 1997
GROUP BY c.CompanyName, c.Country;
---------------------------------------------------------------------
--3. ???????????????? ?????????? ???????????? ?????????????????????????????????????????? ?
--??? Product

--??? Join

SELECT  p.ProductID, p.ProductName, p.UnitPrice,
        s.CompanyName AS SupplierName, s.Country
FROM    Products p
JOIN    Suppliers s ON p.SupplierID = s.SupplierID;
---------------------------------------------------------------------
--4. ????-???????????????????? ?????????? ?????????????????????????????????????????????? 
--??????????????????????????????????-?????? ?? 1997 ???????????????????????????????????????? 10 ?????????? 
--??? Product

--??? Join
SELECT  e.EmployeeID,
        (e.FirstName + ' ' + e.LastName) AS EmpName,
        e.Title,
        COUNT(o.OrderID) AS OrderCount
FROM    Employees e
JOIN    Orders o ON e.EmployeeID = o.EmployeeID
WHERE   YEAR(o.OrderDate) = 1997
  AND   MONTH(o.OrderDate) BETWEEN 1 AND 4
GROUP BY e.EmployeeID, e.FirstName, e.LastName, e.Title
HAVING  COUNT(o.OrderID) > 10;
---------------------------------------------------------------------
--5.???????????????? ?????????? ?????????(????????????) ??????????????????
--??? Product

--??? Join
SELECT  p.ProductID, p.ProductName,
        SUM(od.UnitPrice * od.Quantity) AS TotalSales
FROM    Products p
JOIN    [Order Details] od ON p.ProductID = od.ProductID
GROUP BY p.ProductID, p.ProductName;
---------------------------------------------------------------------
/*6.?????????????????????? ???????????????? ???????????????????????????????????????????????, 
??????, ?????????????, ?????? ?????????????-??????? ?? 1997 */
--??? Product

--??? Join

SELECT  s.ShipperID, s.CompanyName,
        COUNT(o.OrderID) AS OrderCount
FROM    Shippers s
JOIN    Orders o ON s.ShipperID = o.ShipVia
WHERE   YEAR(o.ShippedDate) = 1997
  AND   MONTH(o.ShippedDate) BETWEEN 1 AND 8
  AND   o.ShipCountry IN ('USA','Italy','UK','Canada')
GROUP BY s.ShipperID, s.CompanyName;
---------------------------------------------------------------------
-- *** 3 ????? ****
/*7 : ?????????????? ??????????????(????????????) ????????????????????????????????????? 1996 
?????????????????????????????????,?????????, ???????? */
--??? Product


--??? Join
SELECT  MONTH(o.OrderDate) AS OrderMonth,
        SUM(od.UnitPrice * od.Quantity) AS TotalAmount
FROM    Orders o
JOIN    [Order Details] od ON o.OrderID = od.OrderID
WHERE   YEAR(o.OrderDate) = 1996
  AND   o.ShipCountry IN ('UK','Belgium','Portugal')
GROUP BY MONTH(o.OrderDate)
ORDER BY OrderMonth;
--------------------------------------------------------------------------------

/*8 : ?????????????????????? ???????????????? ?????????(????????????) ????????????????????????????????????????? ??. ?? 1997 
???????????????????????????????????????*/
--??? Product


--??? Join
SELECT  c.CustomerID, c.CompanyName, o.OrderID,
        SUM(od.UnitPrice * od.Quantity) AS OrderTotal
FROM    Customers c
JOIN    Orders o       ON c.CustomerID = o.CustomerID
JOIN    [Order Details] od ON o.OrderID = od.OrderID
WHERE   YEAR(o.OrderDate) = 1997
  AND   MONTH(o.OrderDate) = 1
GROUP BY c.CustomerID, c.CompanyName, o.OrderID
ORDER BY OrderTotal DESC;
---------------------------------------------------------------------------------

/*9 : ??????????????????? ??????????????????? ??????????????? ?????????????????????? Nancy Davolio ??????????????????*/
--??? Product


--??? Join

SELECT  s.ShipperID, s.CompanyName,
        SUM(o.Freight) AS TotalFreight
FROM    Employees e
JOIN    Orders o   ON e.EmployeeID = o.EmployeeID
JOIN    Shippers s ON o.ShipVia    = s.ShipperID
WHERE   (e.FirstName + ' ' + e.LastName) = 'Nancy Davolio'
GROUP BY s.ShipperID, s.CompanyName;
---------------------------------------------------------------------------------
/*10 : ?????????????????????????? ?????????????? ????????????????????? ??????????????? ??????????????????????? ????????????? Tofu ???????? 1997*/
--??? Product


--??? Join
SELECT  o.OrderID, o.OrderDate, o.CustomerID, o.ShipCountry,
        SUM(od.Quantity) AS TotalQty
FROM    Orders o
JOIN    [Order Details] od ON o.OrderID = od.OrderID
JOIN    Products p         ON od.ProductID = p.ProductID
WHERE   p.ProductName = 'Tofu'
  AND   YEAR(o.OrderDate) = 1997
GROUP BY o.OrderID, o.OrderDate, o.CustomerID, o.ShipCountry;
-----------------------------------------------------------------------------
/*11 : ?????????????????????? ?????????? ?????????(????????????) ???????????????????????????????????????????????? ??.-??. ?? 1997*/
--??? Product


--??? Join
SELECT  p.ProductID, p.ProductName,
        SUM(od.UnitPrice * od.Quantity) AS TotalSales
FROM    Products p
JOIN    [Order Details] od ON p.ProductID = od.ProductID
JOIN    Orders o           ON od.OrderID  = o.OrderID
WHERE   YEAR(o.OrderDate) = 1997
  AND   MONTH(o.OrderDate) BETWEEN 1 AND 8
GROUP BY p.ProductID, p.ProductName;
-----------------------------------------------------------------------------
-- *** 4 ????? ****
/*12 : ???????????????????????????? ???????????????? ??????????????(????????????) ??????????????????????????????????????? ???? 1997*/
--??? Product


--??? Join
SELECT  c.CategoryID, c.CategoryName,
        SUM(od.UnitPrice * od.Quantity) AS TotalAmount
FROM    Categories c
JOIN    Products p      ON c.CategoryID = p.CategoryID
JOIN    [Order Details] od ON p.ProductID  = od.ProductID
JOIN    Orders o        ON od.OrderID   = o.OrderID
WHERE   YEAR(o.OrderDate) = 1997
  AND   o.ShipCountry = 'USA'
GROUP BY c.CategoryID, c.CategoryName;
----------------------------------------------------------------------------
/*13 : ????????????????? ??????????????(?????????????????????) ?????????????????????????? ???????????????????????????????? Speedy Express 
??????????????????????? ???????????????????? 1997 */
--??? Product


--??? Join
SELECT  e.EmployeeID,
        (e.FirstName + ' ' + e.LastName) AS EmpName,
        SUM(od.UnitPrice * od.Quantity) AS TotalSales
FROM    Employees e
JOIN    Orders o        ON e.EmployeeID = o.EmployeeID
JOIN    [Order Details] od ON o.OrderID    = od.OrderID
JOIN    Shippers s      ON o.ShipVia    = s.ShipperID
WHERE   s.CompanyName = 'Speedy Express'
  AND   o.ShipCountry = 'USA'
  AND   YEAR(o.OrderDate) = 1997
GROUP BY e.EmployeeID, e.FirstName, e.LastName;
--------------------------------------------------------------------------
/*14 : ???????????????? ?????????? ????????? ???????????????????????????????????????????? ???????????????????? 1997 ???????????????????????????????? */
--??? Product


--??? Join
SELECT  p.ProductID, p.ProductName,
        SUM(od.UnitPrice * od.Quantity) AS TotalSales
FROM    Products p
JOIN    Suppliers s     ON p.SupplierID = s.SupplierID
JOIN    [Order Details] od ON p.ProductID  = od.ProductID
JOIN    Orders o        ON od.OrderID   = o.OrderID
WHERE   s.Country    = 'Japan'
  AND   o.ShipCountry = 'USA'
  AND   YEAR(o.OrderDate) = 1997
GROUP BY p.ProductID, p.ProductName;
----------------------------------------------------------------------------
-- *** 5 ????? ***
/*15 : ???????????????? ???????????????? ???????????????????????????????????????? Beverages ????????????????????  ??????????????? 1997 ????????????????????????????????????*/
--??? Product


--??? Join

SELECT  c.CustomerID, c.CompanyName,
        SUM(od.UnitPrice * od.Quantity) AS TotalAmount
FROM    Customers c
JOIN    Orders o        ON c.CustomerID   = o.CustomerID
JOIN    [Order Details] od ON o.OrderID      = od.OrderID
JOIN    Products p      ON od.ProductID   = p.ProductID
JOIN    Categories cat  ON p.CategoryID   = cat.CategoryID
WHERE   cat.CategoryName = 'Beverages'
  AND   YEAR(o.OrderDate) = 1997
GROUP BY c.CustomerID, c.CompanyName
ORDER BY TotalAmount DESC;
---------------------------------------------------------------------------
/*16 : ??????????????????? ??????????????????? ???????????????????????????????????? Seafood ??????????????????????? ???? 1997 */
--??? Product


--??? Join
SELECT  s.ShipperID, s.CompanyName,
        COUNT(DISTINCT o.OrderID) AS OrderCount
FROM    Shippers s
JOIN    Orders o        ON s.ShipperID = o.ShipVia
JOIN    [Order Details] od ON o.OrderID   = od.OrderID
JOIN    Products p      ON od.ProductID = p.ProductID
JOIN    Categories c    ON p.CategoryID = c.CategoryID
WHERE   c.CategoryName = 'Seafood'
  AND   o.ShipCountry  = 'USA'
  AND   YEAR(o.OrderDate) = 1997
GROUP BY s.ShipperID, s.CompanyName;
---------------------------------------------------------------------------
-- *** 6 ????? ***
/*17 : ?????????????????????? ?????????? ??????????????(????????????) ????????????????? Margaret Peacock ???? 1997 
???????????????????????????????????????????????????? ????????????? ?????? */

--??? Product


--??? Join
SELECT  c.CategoryID, c.CategoryName,
        SUM(od.UnitPrice * od.Quantity) AS TotalAmount
FROM    Employees e
JOIN    Orders o        ON e.EmployeeID = o.EmployeeID
JOIN    [Order Details] od ON o.OrderID    = od.OrderID
JOIN    Products p      ON od.ProductID = p.ProductID
JOIN    Categories c    ON p.CategoryID = c.CategoryID
JOIN    Customers cust  ON o.CustomerID = cust.CustomerID
WHERE   (e.FirstName + ' ' + e.LastName) = 'Margaret Peacock'
  AND   YEAR(o.OrderDate) = 1997
  AND   cust.Country IN ('USA','UK','Canada')
GROUP BY c.CategoryID, c.CategoryName;
---------------------------------------------------------------------------
/*18 : ???????????????? ?????????? ??????????????(????????????) ???????????????????????????????????????????????????????? ???????????????????? 1997 
????????????????????????????????????????? ????????????????????????????????????????????????????? */

--??? Product


--??? Join
SELECT  p.ProductID, p.ProductName,
        SUM(od.UnitPrice * od.Quantity) AS TotalAmount
FROM    Products p
JOIN    Suppliers s     ON p.SupplierID = s.SupplierID
JOIN    [Order Details] od ON p.ProductID  = od.ProductID
JOIN    Orders o        ON od.OrderID   = o.OrderID
JOIN    Customers c     ON o.CustomerID = c.CustomerID
JOIN    Employees e     ON o.EmployeeID = e.EmployeeID
WHERE   s.Country = 'USA'
  AND   c.Country = 'USA'
  AND   e.Country = 'USA'
  AND   YEAR(o.OrderDate) = 1997
GROUP BY p.ProductID, p.ProductName;